function wisplayer(){function p(a,b){var d=q(a);if(d){var c=$(a).width(),e=$(a).find(".wpl-proc"),f=b.pageX-e.offset().left,c=f/c,g=$(a).parents(".wisplayer");d.currentTime=d.duration*c;$(a).parents(".wisplayer").find(".wpl-ptime").text(l(d.currentTime));e.width(f);t(g,d.currentTime)}}function t(a,b){if(!$(a).find(".wpl-lyric").is(":hidden")){var d=$(a).find(".wpl-lyric li"),c=$(a).attr("id"),e=g[c][0],f;for(f in g[c]){f=parseInt(f);var r=void 0==g[c][f+1]?void 0:g[c][f+1];b>=g[c][f]&&(b<r||void 0==
r)?u(d.eq(f)):b<e&&u(d.eq(0))}}}function u(a){if(!$(a).hasClass("current")){$(a).siblings(".current").removeClass("current");$(a).addClass("current");var b=-($(a).position().top-12);$(a).parents(".wpl-lyric").css({marginTop:b+"px"})}}function q(a){return $(a).parents(".wisplayer").find("audio")[0]}function l(a){var b=parseInt(a/60);a=parseInt(a%60);return(10>b?"0"+b:b)+":"+(10>a?"0"+a:a)}var v=0,m={},g={},h={play:"&#xeb01;",pause:"&#xeb02;"},n=!1,w="";$("audio").each(function(){v++;$(this).wrap('<div class="wisplayer" id="wpl-'+
v+'"></div>');var a=$(this).parent(".wisplayer"),b=$(this).find("track").attr("song"),d=$(this).find("track").attr("singer"),c=$(this).find("track").attr("album"),e=$(this).find("track").attr("imgsrc");a.append('<ul class="wpl-main"></ul>').append('<div class="wpl-lyricbox"><div class="wpl-detail"><img src="'+e+'"><ul><li title="'+b+'">'+b+"</li><li>"+d+"</li><li>"+c+'</li></ul></div><ul class="wpl-lyric"></ul></div>').find(".wpl-main").append('<li class="wpl-play"></li>').append('<li class="wpl-right"></li>').append('<li class="wpl-bar"></li>').find(".wpl-play").append('<span class="wpl-playicon iconfont">'+
h.play+"</span>").siblings(".wpl-right").append('<div class="wpl-time"><span class="wpl-ptime">00:00</span> / <span class="wpl-ttime">00:00</div><div class="wpl-lyswt">\u8bcd</div>').siblings(".wpl-bar").append('<div class="wpl-proc"></div>');$(this)[0].addEventListener("canplay",function(){$("#"+a.attr("id")).find(".wpl-ttime").text(l($(this)[0].duration))});b=$(this).find("track").attr("src");$.ajax({url:b,dataType:"text",success:function(b){b=b.replace(/(^s*)|(s*$)/g,"").split("\n");var c=0,d;
for(d in b){var e=/^\[(.*)\](.*)$/g.exec(b[d]);if(void 0!=e){a.find(".wpl-lyric").append("<li>"+e[2]+"</li>");var k=a.attr("id");void 0==g[k]&&(g[k]={});var k=g[k],h=c,e=/^(.*)\:(.*)$/.exec(e[1]),e=void 0!=e?60*parseInt(e[1])+parseFloat(e[2]):"0";k[h]=e;c++}}}})});$(".wpl-play").on("click",function(){var a=$(this).find(".wpl-playicon"),b=$(this).parents(".wisplayer"),d=b.attr("id"),c=q(this);1==c.paused?(c.play(),m[d]=setInterval(function(){var a=c.currentTime,f=c.duration;a>=f&&($(b).find(".wpl-playicon").html(h.play),
clearInterval(m[d]));$(b).find(".wpl-proc").css("width",a/f*100+"%");$(b).find(".wpl-ptime").text(l(a));t(b,a)},200),a.html(h.pause)):(clearInterval(m[d]),c.pause(),a.html(h.play))});$(".wpl-lyswt").on("click",function(){$(this).toggleClass("wpl-lyon");$(this).parents(".wisplayer").toggleClass("wisplayeron");$(this).parents(".wisplayer").find(".wpl-lyricbox").slideToggle(500)});$(document).on("mouseup",function(){n=!1});$(".wisplayer").on("selectstart",function(){return!1});$(".wpl-bar").on("mousedown",
function(a){n=!0;w=this;p(this,a)});$(document).on("mousemove",function(a){1==n&&p(w,a)})};